"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[645],{8374:function(e,t,n){n.d(t,{Go:function(){return T},N:function(){return S},Nk:function(){return f},Ny:function(){return i},QQ:function(){return A},Rf:function(){return E},VP:function(){return d},eu:function(){return N},he:function(){return O},lY:function(){return l},nS:function(){return I},oN:function(){return r},oY:function(){return L},oj:function(){return c},om:function(){return u},th:function(){return w},wZ:function(){return R},xe:function(){return U},xh:function(){return s},z7:function(){return h}});var a=n(7277),o=n(8251);async function E(){let e=await a.Z.load("sqlite:main.db");await e.execute("CREATE TABLE IF NOT EXISTS user \n        (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            pin TEXT NOT NULL,\n            imagePath TEXT,\n            color TEXT UNIQUE,\n            scrollY INTEGER DEFAULT 0\n        )");let t=[];try{t=await e.select("SELECT * from user")}catch(e){console.log(e)}return 0!==t.length?(console.log("confirmed users",t),t):null}async function i(e){let{userPin:t,formData:n}=e,E=await a.Z.load("sqlite:main.db");console.log("Attemping to create new user");try{await E.execute("\n        CREATE TABLE IF NOT EXISTS user \n        (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            pin TEXT NOT NULL,\n            imagePath TEXT,\n            color TEXT UNIQUE, \n            scrollY INTEGER DEFAULT 0\n        )");let e="";await (0,o.dw)("generate_random_color").then(async n=>{await E.execute("INSERT OR IGNORE INTO user (pin, color) VALUES ($1, $2)",[t,n]).then(()=>{e=n.toString()})}),""!==e&&await E.select("SELECT * from user WHERE color = $1",[e]).then(async e=>(1===e.length&&d({formData:n,userId:e[0].id}),await E.close(),e))}catch(e){return console.log(e),await E.close(),!1}}async function r(e){let{userId:t,folderPath:n,expanded:E,asChild:i}=e,r=await a.Z.load("sqlite:main.db");await r.execute("CREATE TABLE IF NOT EXISTS folder (id INTEGER PRIMARY KEY AUTOINCREMENT, userId INTEGER NOT NULL, path TEXT NOT NULL, expanded BOOLEAN NOT NULL DEFAULT 0, asChild BOOLEAN NOT NULL DEFAULT 0, color TEXT, FOREIGN KEY (userId) REFERENCES user(id))").catch(e=>{console.log("error",e)}),await (0,o.dw)("generate_random_mono_color").then(async e=>{await r.execute("INSERT into folder (expanded, path, userId, asChild, color) VALUES ($1, $2, $3, $4, $5)",[E?1:0,n,t,i?1:0,e]).then(()=>{console.log("Created New Folder: ",n.split("\\").pop(),"expanded:",E,"for user",t)}).catch(async e=>(await r.close(),console.log(e),!1))})}async function s(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");try{await n.execute("CREATE TABLE IF NOT EXISTS folder (id INTEGER PRIMARY KEY AUTOINCREMENT, userId INTEGER NOT NULL, path TEXT NOT NULL, expanded BOOLEAN NOT NULL DEFAULT 0, asChild BOOLEAN NOT NULL DEFAULT 0, color TEXT, FOREIGN KEY (userId) REFERENCES user(id))").catch(e=>{console.log("error",e)});try{let e=await n.select("SELECT * from folder WHERE userId = $1",[t]);if(console.log("getFolders() => Folders found from user ".concat(t,":"),e.length),0!==e.length)return e;return[]}catch(e){return await n.close(),console.log(e),[]}}catch(e){return await n.close(),console.log(e),[]}}async function l(e){let{userId:t,folderPath:n,expanded:E,asChild:i}=e,r=await a.Z.load("sqlite:main.db");return await r.execute("CREATE TABLE IF NOT EXISTS folder (id INTEGER PRIMARY KEY AUTOINCREMENT, userId INTEGER NOT NULL, path TEXT NOT NULL, expanded BOOLEAN NOT NULL DEFAULT 0, asChild BOOLEAN NOT NULL DEFAULT 0, color TEXT, FOREIGN KEY (userId) REFERENCES user(id))").catch(e=>{console.log("error",e)}),await r.select("SELECT * from folder WHERE PATH = $1 AND userId = $2",[n,t]).then(async e=>{console.log("folders",e),Array.isArray(e)&&0!==e.length?(await r.execute("UPDATE folder SET expanded = $1 WHERE path = $2 AND userId = $3",[E?1:0,n,t]),console.log("Updated",n.split("\\").pop(),"expanded:",E,"for user",t)):await (0,o.dw)("generate_random_mono_color").then(async e=>{await r.execute("INSERT into folder (expanded, path, userId, asChild, color) VALUES ($1, $2, $3, $4, $5)",[E?1:0,n,t,i?1:0,e]).then(()=>{console.log("Created New Folder: ",n.split("\\").pop(),"expanded:",E,"for user",t)}).catch(async e=>(await r.close(),console.log(e),!1))})}),!0}async function c(e){let{videoPath:t,user:n,watched:o}=e;console.log("Updating watched: ",t.split("\\").pop(),"as",o,"for user",n.id);let E=await a.Z.load("sqlite:main.db");try{await E.execute("\n            CREATE TABLE IF NOT EXISTS video (\n                id INTEGER PRIMARY KEY AUTOINCREMENT, \n                path TEXT NOT NULL, \n                userId INTEGER,\n                watched BOOLEAN NOT NULL DEFAULT 0,\n                lastWatchedAt TIMESTAMP DEFAULT (datetime('now')),\n                FOREIGN KEY (userId) REFERENCES user(id)\n            )\n        ");let e=await E.select("SELECT * from video WHERE path = $1 AND userId = $2",[t,n.id]);0===e.length?await E.execute("INSERT INTO video (path, userId, watched, lastWatchedAt) VALUES ($1, $2, $3, (datetime('now')))",[t,n.id,o?1:0]):await E.execute("UPDATE video SET watched = $3, lastWatchedAt = (datetime('now')) WHERE path = $1 AND userId = $2",[t,n.id,o?1:0])}catch(e){return await E.close(),console.error(e),!1}return!0}async function T(e){let{folderPath:t}=e,n=await a.Z.load("sqlite:main.db");await n.execute("DELETE from folder WHERE path = $1",[t])}async function u(e){let{videoPath:t,userId:n}=e,o=await a.Z.load("sqlite:main.db"),E=[];try{return await o.execute("\n            CREATE TABLE IF NOT EXISTS video (\n                id INTEGER PRIMARY KEY AUTOINCREMENT, \n                path TEXT NOT NULL, \n                userId INTEGER,\n                watched BOOLEAN NOT NULL DEFAULT 0,\n                lastWatchedAt TIMESTAMP DEFAULT (datetime('now')),\n                FOREIGN KEY (userId) REFERENCES user(id)\n            )\n        "),(E=await o.select("SELECT * from video WHERE path = $1 AND userId = $2",[t,n]))[0]}catch(e){console.log(e)}return E&&0!==E.length?E[0]:null}async function d(e){let{formData:t,userId:n}=e,o=await a.Z.load("sqlite:main.db");console.log("updating settings for user:",n),await o.execute("\n    CREATE TABLE IF NOT EXISTS settings (id INTEGER PRIMARY KEY AUTOINCREMENT, userId INTEGER NOT NULL UNIQUE, \n    theme TEXT NOT NULL, \n    fontSize TEXT NOT NULL, \n    animations TEXT NOT NULL, \n    autoRename TEXT NOT NULL, \n    usePin TEXT NOT NULL,\n    FOREIGN KEY (userId) REFERENCES user(id))").catch(e=>{console.log("error",e)}),await o.execute("\n        INSERT INTO settings (userId, theme, fontSize, animations, autoRename, usePin)\n        VALUES ($1, $2, $3, $4, $5, $6)\n        ON CONFLICT(userId) DO UPDATE SET\n        theme = excluded.theme,\n        fontSize = excluded.fontSize,\n        animations = excluded.animations,\n        autoRename = excluded.autoRename,\n        usePin = excluded.usePin\n    ",[n,t.theme,t.fontSize,t.animations,t.autoRename,t.usePin]).catch(e=>{console.log("error",e)})}async function N(e){let{userId:t,newPin:n}=e,o=await a.Z.load("sqlite:main.db");await o.execute("UPDATE user SET pin = $1 WHERE id = $2",[n,t]),await o.close()}async function I(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");try{await n.execute("\n    CREATE TABLE IF NOT EXISTS settings (id INTEGER PRIMARY KEY AUTOINCREMENT, userId INTEGER NOT NULL UNIQUE, \n    theme TEXT NOT NULL, \n    fontSize TEXT NOT NULL, \n    animations TEXT NOT NULL, \n    autoRename TEXT NOT NULL, \n    usePin TEXT NOT NULL,\n    FOREIGN KEY (userId) REFERENCES user(id))").catch(e=>{console.log("error",e)});let e=await n.select("SELECT * from settings WHERE userId = $1",[t]);if(0===e.length)return null;return e[0]}catch(e){return console.log(e),null}}async function R(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");await n.execute("UPDATE settings SET usePin = 'On' WHERE userId = $1",[t]),await n.close()}async function L(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");try{await n.execute("\n            CREATE TABLE IF NOT EXISTS global (\n                id TEXT PRIMARY KEY, \n                userId INTEGER NOT NULL\n            )\n        "),await n.execute("\n            INSERT INTO global (id, userId) \n            VALUES ($1, $2)\n            ON CONFLICT(id) DO UPDATE SET \n            userId = excluded.userId\n        ",["GID99844589388427",t])}catch(e){return await n.close(),console.log(e),!1}return!0}async function A(){let e=await a.Z.load("sqlite:main.db");try{await e.execute("\n        CREATE TABLE IF NOT EXISTS global (\n        id TEXT PRIMARY KEY, \n        userId INTEGER NOT NULL\n        )");let t=await e.select("SELECT * from global WHERE id = $1",["GID99844589388427"]);if(t)return t[0];return null}catch(t){return await e.close(),console.log(t),null}}async function f(e){let{userId:t,imagePath:n}=e,E=await a.Z.load("sqlite:main.db"),i=(0,o.Lk)(n);await E.execute("UPDATE user SET imagePath = $1 WHERE id = $2",[i,t]),await E.close()}async function O(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");try{await n.execute("DELETE FROM folder WHERE userId = $1",[t]),await n.execute("DELETE FROM settings WHERE userId = $1",[t]),await n.execute("DELETE FROM video WHERE userId = $1",[t]),await n.execute("DELETE FROM user WHERE id = $1",[t]),console.log("deleteProfile() => Deleted user:",t)}catch(e){await n.close(),console.log(e)}finally{await n.close()}}async function w(e){let{userId:t,scrollY:n}=e,o=await a.Z.load("sqlite:main.db");await o.execute("UPDATE user SET scrollY = $1 WHERE id = $2",[n,t])}async function S(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");try{let e=await n.select("SELECT scrollY from user WHERE id = $1",[t]);if(e)return e[0].scrollY}catch(e){return console.log(e),await n.close(),null}}async function h(e){let{userId:t}=e,n=await a.Z.load("sqlite:main.db");try{let e=await n.select("SELECT * from video WHERE userId = $1",[t]);if(0!==e.length)return e;return[]}catch(e){return console.log(e),await n.close(),null}}async function U(){let e=await a.Z.load("sqlite:main.db");await e.close()}},7147:function(e,t,n){n.d(t,{Am:function(){return T},pm:function(){return u}});var a=n(4090);let o=0,E=new Map,i=e=>{if(E.has(e))return;let t=setTimeout(()=>{E.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);E.set(e,t)},r=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?i(n):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},s=[],l={toasts:[]};function c(e){l=r(l,e),s.forEach(e=>{e(l)})}function T(e){let{...t}=e,n=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:n});return c({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||a()}}}),{id:n,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function u(){let[e,t]=a.useState(l);return a.useEffect(()=>(s.push(t),()=>{let e=s.indexOf(t);e>-1&&s.splice(e,1)}),[e]),{...e,toast:T,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},2169:function(e,t,n){n.d(t,{cn:function(){return E}});var a=n(3167),o=n(1367);function E(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,a.W)(t))}}}]);